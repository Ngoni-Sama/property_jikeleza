
var current_no_up;jQuery(document).ready(function(c){wpestate_delete_binder();wpestate_caption_setter();var b;var a=0;current_no_up=parseInt(c(".uploaded_images ").length,10);b=0;if(typeof(plupload)!=="undefined"){var d=new plupload.Uploader(ajax_vars.plupload);d.init();d.bind("FilesAdded",function(e,g){if(ajax_vars.max_images>0){if(current_no_up===0){b=ajax_vars.max_images;if(g.length>ajax_vars.max_images){current_no_up=b}else{current_no_up=g.length}}else{if(current_no_up>=ajax_vars.max_images){b=-1}else{b=ajax_vars.max_images-current_no_up;if(g.length>b){current_no_up=current_no_up+b}else{current_no_up=current_no_up+g.length}}}if(b>0){e.files.slice(0,b);g.slice(0,b);var f=b;while(g.length>b){e.files.pop();g.pop();a=1}}if(a===1){c(".image_max_warn").remove();c("#imagelist").before('<div class="image_max_warn" style="width:100%;float:left;">'+ajax_vars.warning_max+"</div>")}if(b==-1){c(".image_max_warn").remove();c("#imagelist").before('<div class="image_max_warn" style="width:100%;float:left;">'+ajax_vars.warning_max+"</div>");g=[];e=[];return}}c.each(g,function(j,h){c("#aaiu-upload-imagelist").append('<div id="'+h.id+'">'+h.name+" ("+plupload.formatSize(h.size)+") <b></b></div>")});e.refresh();d.start()});d.bind("UploadProgress",function(e,f){c("#"+f.id+" b").html(f.percent+"%")});d.bind("Error",function(e,f){c("#aaiu-upload-imagelist").append("<div>Error: "+f.code+", Message: "+f.message+(f.file?", File: "+f.file.name:"")+"</div>");e.refresh()});d.bind("FileUploaded",function(f,i,h){var e=c.parseJSON(h.response);c("#image_warn").remove();c("#"+i.id).remove();if(e.success){c("#profile-image").attr("src",e.html);c("#profile-image").attr("data-profileurl",e.html);c("#profile-image").attr("data-smallprofileurl",e.attach);var g=c("#attachid").val();g=g+","+e.attach;c("#attachid").val(g);if(e.html!==""){if(ajax_vars.is_floor==="1"){c("#no_plan_mess").remove();c("#imagelist").append('<div class="uploaded_images floor_container" data-imageid="'+e.attach+'"><input type="hidden" name="plan_image_attach[]" value="'+e.attach+'"><input type="hidden" name="plan_image[]" value="'+e.html+'"><img src="'+e.html+'"  /><i class="fa deleter fa-trash-o"></i>'+to_insert_floor+"</div>")}else{c("#imagelist").append('<div class="uploaded_images" data-imageid="'+e.attach+'"><img src="'+e.html+'"  /><i class="fa deleter fa-trash-o"></i><i class="fa fa-font image_caption_button"></i><div class="image_caption_wrapper"><input data-imageid="'+e.attach+'" type="text" class="image_caption form_control" name="image_caption" value=""></div>')}}else{c("#imagelist").append('<div class="uploaded_images" data-imageid="'+e.attach+'"><img src="'+ajax_vars.path+'/img/pdf.png"  /><i class="fa deleter fa-trash-o"></i> </div>')}if(jQuery().sortable){c("#imagelist").sortable({revert:true,update:function(l,m){var k,j;k="";c("#imagelist .uploaded_images").each(function(){j=c(this).attr("data-imageid");if(typeof j!="undefined"){k=k+","+j}});c("#attachid").val(k)},})}wpestate_delete_binder();wpestate_caption_setter();wpestate_thumb_setter()}else{if(e.image){c("#imagelist").before('<div id="image_warn" style="width:100%;float:left;">'+ajax_vars.warning+"</div>");current_no_up=current_no_up-1}}});jQuery("#aaiu-uploader").on("click",function(f){f.preventDefault();d.splice();d.refresh()});c("#aaiu-uploader2").on("click",function(f){d.start();f.preventDefault()});c("#aaiu-uploader-floor").on("click",function(f){f.preventDefault();c("#aaiu-uploader").trigger("click")});d.splice();d.refresh()}d.splice();d.refresh()});function wpestate_thumb_setter(){jQuery("#imagelist img").dblclick(function(){jQuery("#imagelist .uploaded_images .thumber").each(function(){jQuery(this).remove()});jQuery(this).parent().append('<i class="fa thumber fa-star"></i>');jQuery("#attachthumb").val(jQuery(this).parent().attr("data-imageid"))})}function wpestate_delete_binder(){jQuery("#imagelist i.fa-trash-o").unbind("click");jQuery("#imagelist i.fa-trash-o").on("click",function(e){var d="";var b="";var a=jQuery(this).parent().attr("data-imageid");var c=jQuery("#wpestate_image_upload").val();current_no_up=current_no_up-1;jQuery(this).parent().remove();jQuery("#imagelist .uploaded_images").each(function(){b=jQuery(this).attr("data-imageid");d=d+","+b});jQuery("#attachid").val(d);jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpestate_delete_file",attach_id:a,security:c,},success:function(f){},error:function(f){}})})}function wpestate_caption_setter(){jQuery(".image_caption_button").unbind("click");jQuery(".image_caption_button").on("click",function(a){jQuery(this).toggleClass("active_caption");jQuery(this).parent().find(".image_caption_wrapper").toggle()});jQuery(".image_caption").unbind("change");jQuery(".image_caption").on("change",function(){var b=jQuery(this).attr("data-imageid");var a=jQuery(this).val();var c=jQuery("#wpestate_image_upload").val();jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpestate_image_caption",attach_id:b,caption:a,security:c},success:function(d){},error:function(d){}})})}to_insert_floor='<div class=""><p class="meta-options floor_p">\n                <label for="plan_title">'+control_vars.plan_title+'</label><br />\n                <input id="plan_title" type="text" size="36" name="plan_title[]" value="" />\n            </p>\n            \n            <p class="meta-options floor_full"> \n                <label for="plan_description">'+control_vars.plan_desc+'</label><br /> \n                <textarea class="plan_description" type="text" size="36" name="plan_description[]" ></textarea> \n            </p>\n             \n            <p class="meta-options floor_p"> \n                <label for="plan_size">'+control_vars.plan_size+'</label><br /> \n                <input id="plan_size" type="text" size="36" name="plan_size[]" value="" /> \n            </p> \n            \n            <p class="meta-options floor_p"> \n                <label for="plan_rooms">'+control_vars.plan_rooms+'</label><br /> \n                <input id="plan_rooms" type="text" size="36" name="plan_rooms[]" value="" /> \n            </p> \n            <p class="meta-options floor_p"> \n                <label for="plan_bath">'+control_vars.plan_bathrooms+'</label><br /> \n                <input id="plan_bath" type="text" size="36" name="plan_bath[]" value="" /> \n            </p> \n            <p class="meta-options floor_p"> \n                <label for="plan_price">'+control_vars.plan_price+'</label><br /> \n                <input id="plan_price" type="text" size="36" name="plan_price[]" value="" /> \n            </p> \n    </div>';